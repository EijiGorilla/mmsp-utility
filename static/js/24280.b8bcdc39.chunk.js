"use strict";(self.webpackChunkmmsp_utility=self.webpackChunkmmsp_utility||[]).push([[24280],{2257:(t,e,n)=>{n.d(e,{D8:()=>o,TO:()=>r,d0:()=>l});var i=n(53430);async function r(t){var e,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.popupTemplate;if(null==r)return[];const o=await r.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:l}=r,{objectIdField:a,typeIdField:s,globalIdField:u,relationships:c}=t;if(o.includes("*"))return["*"];const h=l?(0,i.eX)(t):[],d=(0,i.DB)(t.fieldsIndex,[...o,...h]);return s&&d.push(s),d&&a&&null!==(e=t.fieldsIndex)&&void 0!==e&&e.has(a)&&!d.includes(a)&&d.push(a),d&&u&&null!==(n=t.fieldsIndex)&&void 0!==n&&n.has(u)&&!d.includes(u)&&d.push(u),c&&c.forEach(e=>{var n;const{keyField:i}=e;d&&i&&(null===(n=t.fieldsIndex)||void 0===n?void 0:n.has(i))&&!d.includes(i)&&d.push(i)}),d}function o(t,e){return t.popupTemplate?t.popupTemplate:null!=e&&e.defaultPopupTemplateEnabled&&null!=t.defaultPopupTemplate?t.defaultPopupTemplate:null}function l(t,e){return null!=o(t,{defaultPopupTemplateEnabled:e})}},31516:(t,e,n)=>{n.d(e,{F:()=>o});n(18690),n(53084);var i=n(18288),r=n(48718);n(42052),n(72027);function o(t,e,n){if(null==(null===t||void 0===t?void 0:t.timeInfo))return null;const{datesInUnknownTimezone:o=!1,timeOffset:l,useViewTime:a}=t;let s=t.timeExtent;o&&(s=function(t){if(!t)return t;const{start:e,end:n}=t;return new r.T({start:null!=e?(0,i.S1)(e,e.getTimezoneOffset(),"minutes"):e,end:null!=n?(0,i.S1)(n,n.getTimezoneOffset(),"minutes"):n})}(s));let u=a?e&&s?e.intersection(s):e||s:s;return!u||u.isEmpty||u.isAllTime?u:(l&&(u=u.offset(-l.value,l.unit)),o&&(u=function(t){if(!t)return t;const{start:e,end:n}=t;return new r.T({start:null!=e?(0,i.S1)(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=n?(0,i.S1)(n,-n.getTimezoneOffset(),"minutes"):n})}(u)),u.equals(n)?n:u)}},46533:(t,e,n)=>{n.d(e,{CW:()=>d,DE:()=>f,pH:()=>y,qH:()=>m});var i=n(81806),r=n(76460),o=n(15941),l=n(50346),a=n(47249),s=n(76797),u=n(80963);const c=()=>r.A.getLogger("esri.views.2d.engine.flow.dataUtils"),h=10;async function d(t,e,n,r){const o=performance.now(),s=f(e,n),u=performance.now(),d=m(e,s,n.width,n.height),p=performance.now(),g=function(t,e){const n=new a.A,i=t.reduce((t,e)=>t+e.length,0),r=new Float32Array(4*i),o=new Array(t.length);let l=0,s=0;for(const a of t){const t=l;for(const e of a)r[4*l]=e.x,r[4*l+1]=e.y,r[4*l+2]=e.t,r[4*l+3]=e.speed,l++;o[s++]={startVertex:t,numberOfVertices:a.length,totalTime:a[a.length-1].t,timeSeed:e?n.getFloat():0}}return{lineVertices:r,lineDescriptors:o}}(d,!0),y=performance.now(),w="Streamlines"===t?function(t,e){const n=9,{lineVertices:i,lineDescriptors:r}=t;let o=0,l=0;for(const f of r)o+=2*f.numberOfVertices,l+=6*(f.numberOfVertices-1);const a=new Float32Array(o*n),s=new Uint32Array(l);let u=0,c=0;function h(){s[c++]=u-2,s[c++]=u,s[c++]=u-1,s[c++]=u,s[c++]=u+1,s[c++]=u-1}function d(t,e,i,r,o,l,s,c){const h=u*n;let d=0;a[h+d++]=t,a[h+d++]=e,a[h+d++]=1,a[h+d++]=i,a[h+d++]=l,a[h+d++]=s,a[h+d++]=r/2,a[h+d++]=o/2,a[h+d++]=c,u++,a[h+d++]=t,a[h+d++]=e,a[h+d++]=-1,a[h+d++]=i,a[h+d++]=l,a[h+d++]=s,a[h+d++]=-r/2,a[h+d++]=-o/2,a[h+d++]=c,u++}for(const f of r){const{totalTime:t,timeSeed:n}=f;let r=null,o=null,l=null,a=null,s=null,u=null;for(let c=0;c<f.numberOfVertices;c++){const p=i[4*(f.startVertex+c)],m=i[4*(f.startVertex+c)+1],g=i[4*(f.startVertex+c)+2],y=i[4*(f.startVertex+c)+3];let w=null,v=null,x=null,_=null;if(c>0){w=p-r,v=m-o;const i=Math.sqrt(w*w+v*v);if(w/=i,v/=i,c>1){let t=w+s,n=v+u;const i=Math.sqrt(t*t+n*n);t/=i,n/=i;const r=Math.min(1/(t*w+n*v),e);t*=r,n*=r,x=-n,_=t}else x=-v,_=w;null!==x&&null!==_&&(d(r,o,l,x,_,t,n,y),h())}r=p,o=m,l=g,s=w,u=v,a=y}d(r,o,l,-u,s,t,n,a)}return{vertexData:a,indexData:s}}(g,h):function(t){const e=16,n=1,i=2,{lineVertices:r,lineDescriptors:o}=t;let l=0,a=0;for(const L of o){const t=L.numberOfVertices-1;l+=4*t*2,a+=6*t*2}const s=new Float32Array(l*e),u=new Uint32Array(a);let c,h,d,f,p,m,g,y,w,v,x,_,b,S,M=0,T=0;function I(){u[T++]=M-8,u[T++]=M-7,u[T++]=M-6,u[T++]=M-7,u[T++]=M-5,u[T++]=M-6,u[T++]=M-4,u[T++]=M-3,u[T++]=M-2,u[T++]=M-3,u[T++]=M-1,u[T++]=M-2}function A(t,r,o,l,a,u,c,h,d,f,p,m,g,y){const w=M*e;let v=0;for(const e of[n,i])for(const n of[1,2,3,4])s[w+v++]=t,s[w+v++]=r,s[w+v++]=o,s[w+v++]=l,s[w+v++]=c,s[w+v++]=h,s[w+v++]=d,s[w+v++]=f,s[w+v++]=e,s[w+v++]=n,s[w+v++]=g,s[w+v++]=y,s[w+v++]=a/2,s[w+v++]=u/2,s[w+v++]=p/2,s[w+v++]=m/2,M++}function D(t,e){let n=w+x,i=v+_;const r=Math.sqrt(n*n+i*i);n/=r,i/=r;const o=w*n+v*i;n/=o,i/=o;let l=x+b,a=_+S;const s=Math.sqrt(l*l+a*a);l/=s,a/=s;const u=x*l+_*a;l/=u,a/=u,A(c,h,d,f,-i,n,p,m,g,y,-a,l,t,e),I()}function F(t,e,n,i,r,o){if(w=x,v=_,x=b,_=S,null==w&&null==v&&(w=x,v=_),null!=p&&null!=m){b=t-p,S=e-m;const n=Math.sqrt(b*b+S*S);b/=n,S/=n}null!=w&&null!=v&&D(r,o),c=p,h=m,d=g,f=y,p=t,m=e,g=n,y=i}function k(t,e){w=x,v=_,x=b,_=S,null==w&&null==v&&(w=x,v=_),null!=w&&null!=v&&D(t,e)}for(const L of o){c=null,h=null,d=null,f=null,p=null,m=null,g=null,y=null,w=null,v=null,x=null,_=null,b=null,S=null;const{totalTime:t,timeSeed:e}=L;for(let n=0;n<L.numberOfVertices;n++)F(r[4*(L.startVertex+n)],r[4*(L.startVertex+n)+1],r[4*(L.startVertex+n)+2],r[4*(L.startVertex+n)+3],t,e);k(t,e)}return{vertexData:s,indexData:u}}(g),v=performance.now();return(0,i.A)("esri-2d-profiler")&&(c().info("I.1","_createFlowFieldFromData (ms)",Math.round(u-o)),c().info("I.2","_getStreamlines (ms)",Math.round(p-u)),c().info("I.3","createAnimatedLinesData (ms)",Math.round(y-p)),c().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(v-y)),c().info("I.5","createFlowMesh (ms)",Math.round(v-o)),c().info("I.6","Mesh size (bytes)",w.vertexData.buffer.byteLength+w.indexData.buffer.byteLength)),await Promise.resolve(),(0,l.Te)(r),w}function f(t,e){const n=function(t,e,n,i){if(0===i)return t;const r=Math.round(3*i),o=new Array(2*r+1);let l=0;for(let u=-r;u<=r;u++){const t=Math.exp(-u*u/(i*i));o[u+r]=t,l+=t}for(let u=-r;u<=r;u++)o[u+r]/=l;const a=new Float32Array(t.length);for(let u=0;u<n;u++)for(let n=0;n<e;n++){let i=0,l=0;for(let a=-r;a<=r;a++){if(n+a<0||n+a>=e)continue;const s=o[a+r];i+=s*t[2*(u*e+(n+a))],l+=s*t[2*(u*e+(n+a))+1]}a[2*(u*e+n)]=i,a[2*(u*e+n)+1]=l}const s=new Float32Array(t.length);for(let u=0;u<e;u++)for(let t=0;t<n;t++){let i=0,l=0;for(let s=-r;s<=r;s++){if(t+s<0||t+s>=n)continue;const c=o[s+r];i+=c*a[2*((t+s)*e+u)],l+=c*a[2*((t+s)*e+u)+1]}s[2*(t*e+u)]=i,s[2*(t*e+u)+1]=l}return s}(e.data,e.width,e.height,t.smoothing);return t.interpolate?(t,i)=>{const r=Math.floor(t),o=Math.floor(i);if(r<0||r>=e.width)return[0,0];if(o<0||o>=e.height)return[0,0];const l=t-r,a=i-o,s=r,u=o,c=r<e.width-1?r+1:r,h=o<e.height-1?o+1:o,d=n[2*(u*e.width+s)],f=n[2*(u*e.width+c)],p=n[2*(h*e.width+s)],m=n[2*(h*e.width+c)],g=n[2*(u*e.width+s)+1],y=n[2*(u*e.width+c)+1];return[(d*(1-a)+p*a)*(1-l)+(f*(1-a)+m*a)*l,(g*(1-a)+n[2*(h*e.width+s)+1]*a)*(1-l)+(y*(1-a)+n[2*(h*e.width+c)+1]*a)*l]}:(t,i)=>{const r=Math.round(t),o=Math.round(i);return r<0||r>=e.width||o<0||o>=e.height?[0,0]:[n[2*(o*e.width+r)],n[2*(o*e.width+r)+1]]}}function p(t,e,n,i,r,o,l,a,s){const u=[];let c=n,h=i,d=0,[f,p]=e(c,h);f*=t.velocityScale,p*=t.velocityScale;const m=Math.sqrt(f*f+p*p);let g,y;u.push({x:c,y:h,t:d,speed:m});for(let w=0;w<t.verticesPerLine;w++){let[n,i]=e(c,h);n*=t.velocityScale,i*=t.velocityScale;const f=Math.sqrt(n*n+i*i);if(f<t.minSpeedThreshold)return u;const p=n/f,m=i/f;if(c+=p*t.segmentLength,h+=m*t.segmentLength,d+=t.segmentLength/f,Math.acos(p*g+m*y)>t.maxTurnAngle)return u;if(t.collisions){const t=Math.round(c*s),e=Math.round(h*s);if(t<0||t>l-1||e<0||e>a-1)return u;const n=o[e*l+t];if(-1!==n&&n!==r)return u;o[e*l+t]=r}u.push({x:c,y:h,t:d,speed:f}),g=p,y=m}return u}function m(t,e,n,i){const r=[],o=new a.A,l=1/Math.max(t.lineCollisionWidth,1),s=Math.round(n*l),u=Math.round(i*l),c=new Int32Array(s*u);for(let a=0;a<c.length;a++)c[a]=-1;const h=[];for(let a=0;a<i;a+=t.lineSpacing)for(let e=0;e<n;e+=t.lineSpacing)h.push({x:e,y:a,sort:o.getFloat()});h.sort((t,e)=>t.sort-e.sort);for(const{x:a,y:d}of h)if(o.getFloat()<t.density){const n=p(t,e,a,d,r.length,c,s,u,l);if(n.length<2)continue;r.push(n)}return r}function g(t,e){const n=e.pixels,{width:i,height:r}=e,l=new Float32Array(i*r*2),a=e.mask||new Uint8Array(i*r*2);if(e.mask||a.fill(255),"vector-uv"===t)for(let o=0;o<i*r;o++)l[2*o]=n[0][o],l[2*o+1]=-n[1][o];else if("vector-magdir"===t)for(let s=0;s<i*r;s++){const t=n[0][s],e=(0,o.kU)(n[1][s]),i=Math.cos(e-Math.PI/2),r=Math.sin(e-Math.PI/2);l[2*s]=i*t,l[2*s+1]=r*t}return{data:l,mask:a,width:i,height:r}}async function y(t,e,n,r,o,l){const a=performance.now(),h=(0,u.Vp)(e.spatialReference);if(!h){const s=await w(t,e,n,r,o,l);return(0,i.A)("esri-2d-profiler")&&c().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-a)),(0,i.A)("esri-2d-profiler")&&c().info("I.9","Number of parts",1),s}const[d,f]=h.valid,p=f-d,m=Math.ceil(e.width/p),g=e.width/m,y=Math.round(n/m);let v=e.xmin;const x=[],_=performance.now();for(let i=0;i<m;i++){const n=new s.A({xmin:v,xmax:v+g,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});x.push(w(t,n,y,r,o,l)),v+=g}const b=await Promise.all(x);(0,i.A)("esri-2d-profiler")&&c().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-_)),(0,i.A)("esri-2d-profiler")&&c().info("I.9","Number of parts",b.length);const S={data:new Float32Array(n*r*2),mask:new Uint8Array(n*r),width:n,height:r};let M=0;for(const i of b){for(let t=0;t<i.height;t++)for(let e=0;e<i.width;e++)M+e>=n||(S.data[2*(t*n+M+e)]=i.data[2*(t*i.width+e)],S.data[2*(t*n+M+e)+1]=i.data[2*(t*i.width+e)+1],S.mask[t*n+M+e]=i.mask[t*i.width+e]);M+=i.width}return(0,i.A)("esri-2d-profiler")&&c().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-a)),S}async function w(t,e,n,i,r,o){const l={requestProjectedLocalDirections:!0,signal:o};if(null!=r&&(l.timeExtent=r),"imagery"===t.type){var a;await t.load({signal:o});const r=await t.internalFetchImage(e,n,i,l);return null==(null===r||void 0===r||null===(a=r.pixelData)||void 0===a?void 0:a.pixelBlock)?{data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i}:g(t.rasterInfo.dataType,r.pixelData.pixelBlock)}await t.load({signal:o});const s=await t.fetchPixels(e,n,i,l);return null==(null===s||void 0===s?void 0:s.pixelBlock)?{data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i}:g(t.serviceRasterInfo.dataType,s.pixelBlock)}},66917:(t,e,n)=>{n.d(e,{EO:()=>d,Lu:()=>o,Sl:()=>m,UL:()=>c,YC:()=>s,hq:()=>r,l0:()=>a,oU:()=>u,r$:()=>f,vG:()=>p});var i=n(76931);n(63919),n(85827);function r(t){const e=o(s(t)),n=e,r=Math.max(e/2,5),l=Math.round((0,i.Lz)(t.maxPathLength)/r)+1,{density:a}=t;return{smoothing:(0,i.Lz)(t.smoothing),interpolate:!0,velocityScale:"flow-from"===t.flowRepresentation?1:-1,verticesPerLine:l,minSpeedThreshold:.001,segmentLength:r,maxTurnAngle:1,collisions:!0,lineCollisionWidth:n,lineSpacing:10,density:a}}function o(t){return"constant"===t.kind?t.value[0]:t.values[t.values.length-1]}function l(t){const e=t.toRgba();return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function a(t){return{kind:"constant",value:[.1,.1,.1,1]}}function s(t){if(!t.hasVisualVariables("size"))return{kind:"constant",value:[(0,i.Lz)(t.trailWidth)]};const e=t.getVisualVariablesForType("size")[0],n=[],r=[];let o;if(e.stops){for(const t of e.stops)n.push(t.value),r.push((0,i.Lz)(t.size));o=e.stops.length}else n.push(e.minDataValue,e.maxDataValue),r.push((0,i.Lz)(e.minSize),(0,i.Lz)(e.maxSize)),o=2;return{kind:"ramp",stops:n,values:r,count:o}}function u(t){if(!t.hasVisualVariables("color"))return{kind:"constant",value:l(t.color)};const e=t.getVisualVariablesForType("color")[0],n=[],i=[];for(const r of e.stops)n.push(r.value),Array.prototype.push.apply(i,l(r.color));return{kind:"ramp",stops:n,values:i,count:e.stops.length}}function c(t){if(!t.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const e=t.getVisualVariablesForType("opacity")[0],n=[],i=[];for(const r of e.stops)n.push(r.value),i.push(r.opacity);return{kind:"ramp",stops:n,values:i,count:e.stops.length}}function h(t,e,n,i){switch(e){case"int":t.setUniform1iv(n,i);break;case"float":t.setUniform1fv(n,i);break;case"vec2":t.setUniform2fv(n,i);break;case"vec3":t.setUniform3fv(n,i);break;case"vec4":t.setUniform4fv(n,i)}}function d(t,e,n,i){"constant"===i.kind?h(t,n,"u_".concat(e),i.value):(h(t,"float","u_".concat(e,"_stops"),i.stops),h(t,n,"u_".concat(e,"_values"),i.values),t.setUniform1i("u_".concat(e,"_count"),i.count))}function f(t,e){let n=!0;return n=n&&t.collisions===e.collisions,n=n&&t.density===e.density,n=n&&t.interpolate===e.interpolate,n=n&&t.lineCollisionWidth===e.lineCollisionWidth,n=n&&t.lineSpacing===e.lineSpacing,n=n&&t.maxTurnAngle===e.maxTurnAngle,n=n&&t.minSpeedThreshold===e.minSpeedThreshold,n=n&&t.segmentLength===e.segmentLength,n=n&&t.smoothing===e.smoothing,n=n&&t.velocityScale===e.velocityScale,n=n&&t.verticesPerLine===e.verticesPerLine,n}function p(t,e){return t===e||null!=t&&null!=e&&t.equals(e)}function m(t,e){if(!f(t.simulationSettings,e.simulationSettings))return!1;if(!p(t.timeExtent,e.timeExtent))return!1;let n=!0;return n=n&&t.loadImagery===e.loadImagery,n=n&&t.createFlowMesh===e.createFlowMesh,n=n&&t.color.kind===e.color.kind,n=n&&t.opacity.kind===e.opacity.kind,n=n&&t.size.kind===e.size.kind,n}},70667:(t,e,n)=>{n.d(e,{t:()=>g,z:()=>v});var i=n(19555),r=n(72745),o=n(55855),l=n(34111),a=n(482),s=n(44815),u=n(75002),c=n(38496),h=n(64465),d=n(50468),f=n(17345),p=n(66470),m=n(34017);function g(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=[],g=e.mapPositions;!function(t,e){const{attributeData:{position:n},removeDuplicateStartEnd:i}=t,r=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(n)&&i,o=n.length/3-(r?1:0),l=new Array(2*(o-1)),a=r?n.slice(0,-3):n;let s=0;for(let u=0;u<o-1;u++)l[s++]=u,l[s++]=u+1;e.push([p.r.POSITION,new d.n(a,l,3,r)])}(e,r);const v=r[0][1].data,x=r[0][1].indices.length,_=(0,c.EH)(x);return function(t,e,n){if(null!=t.attributeData.colorFeature)return;const i=t.attributeData.color;e.push([p.r.COLOR,new d.n(null!==i&&void 0!==i?i:o.Un,n,4)])}(e,r,_),function(t,e,n){var i;null==t.attributeData.sizeFeature&&e.push([p.r.SIZE,new d.n([null!==(i=t.attributeData.size)&&void 0!==i?i:1],n,1,!0)])}(e,r,_),function(t,e,n){t.attributeData.normal&&e.push([p.r.NORMAL,new d.n(t.attributeData.normal,n,3)])}(e,r,_),function(t,e,n){null!=t.attributeData.colorFeature&&e.push([p.r.COLORFEATUREATTRIBUTE,new d.n([t.attributeData.colorFeature],n,1,!0)])}(e,r,_),function(t,e,n){null!=t.attributeData.sizeFeature&&e.push([p.r.SIZEFEATUREATTRIBUTE,new d.n([t.attributeData.sizeFeature],n,1,!0)])}(e,r,_),function(t,e,n){null!=t.attributeData.opacityFeature&&e.push([p.r.OPACITYFEATUREATTRIBUTE,new d.n([t.attributeData.opacityFeature],n,1,!0)])}(e,r,_),function(t,e,n){if(null==t.overlayInfo||t.overlayInfo.renderCoordsHelper.viewingMode!==h.RT.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=(0,s.jh)(n.length),o=(0,l.tO)(t.overlayInfo.spatialReference);for(let i=0;i<r.length;i+=3)(0,a.RC)(n,i,r,i,o);const c=n.length/3,f=(0,u.oe)(c+1);let m=y,g=w,v=0,x=0;(0,i.hZ)(m,r[x++],r[x++]),x++,f[0]=0;for(let l=1;l<c+1;++l)l===c&&(x=0),(0,i.hZ)(g,r[x++],r[x++]),x++,v+=(0,i.xg)(m,g),f[l]=v,[m,g]=[g,m];e.push([p.r.DISTANCETOSTART,new d.n(f,e[0][1].indices,1,!0)])}(e,r,v),new f.V(t,r,g,m.d.Line,n)}const y=(0,r.vt)(),w=(0,r.vt)();function v(t,e){if(null==t||0===t.length)return[];const n=[];return t.forEach(t=>{const i=t.length,r=(0,s.jh)(3*i);t.forEach((t,e)=>{r[3*e]=t[0],r[3*e+1]=t[1],r[3*e+2]=t[2]});const o={attributeData:{position:r,normal:e},removeDuplicateStartEnd:!1};n.push(o)}),n}},74283:(t,e,n)=>{n.d(e,{A:()=>E});var i=n(35143),r=(n(81806),n(30726)),o=n(50346),l=n(68134),a=n(46053),s=(n(76460),n(47249),n(85842)),u=n(9956),c=n(2413),h=n(731),d=n(46533),f=n(66917),p=n(69576),m=n(9392),g=n(55855),y=n(12482),w=n(70667),v=n(425),x=n(46259);function _(t,e,n,i){const{spatialReference:r}=t;return function(t){const e=(0,w.z)(t),n=new v.W({width:2,color:(0,g.fA)(.1,.2,1,1),innerWidth:1,innerColor:(0,g.fA)(.2,.4,1,1),cap:x.x.ROUND});return e.map(t=>(0,w.t)(n,t))}(n.map(n=>n.map(n=>{const[o,l]=function(t,e){let{x:n,y:i}=t;const{extent:r,size:[o,l]}=e;return[n/o*r.width+r.xmin,(l-i)/l*r.height+r.ymin]}(n,e),{absoluteZ:a}=(0,y.Q5)(o,l,0,r,t,i),s=(0,m.fA)(o,l,a);return t.renderCoordsHelper.toRenderCoords(s,r,s),s})))}function b(t,e,n){let[i,r,o,l]=[null,null,null,null];for(e.reset(t);!e.done;){const t=e.next();if(null==t)continue;if(!t.visible){e.skipSubtree();continue}const a=t.extent;t.leaf&&t.rendered&&(0,c.HY)(a,n)&&(i=M(a[0],i),r=M(a[1],r),o=S(a[2],o),l=S(a[3],l))}return null==i||null==r||null==o||null==l?null:(0,c.vt)([i,r,o,l])}function S(t,e){return null==e?t:Math.max(t,e)}function M(t,e){return null==e?t:Math.min(t,e)}var T=n(91967),I=n(37046),A=n(44513),D=n(8918);class F{constructor(t,e){this.streamlines=t,this._geometries=e,this._object3D=null,this._engineLayer=null}get attached(){return null!=this._object3D&&null!=this._engineLayer}attach(t){const{_geometries:e}=this;if(null==e)return;this.detach();const n=new D.x(t,{pickable:!1,updatePolicy:A.q.SYNC}),i=new I.B({geometries:e});i.visible=!0,n.add(i),this._object3D=i,this._engineLayer=n}detach(){this.attached&&(this._engineLayer=(0,r.pR)(this._engineLayer),this._object3D=(0,r.WD)(this._object3D))}}let k=class extends T.A{constructor(t){super(t),this.simulationSettings=null,this.loadImagery=null,this.createGeometry=null}async load(t,e){const n=await this.loadImagery(t,e);if(null==n)return null;const i=this._createFlowFieldFromData(n),r=this._getStreamlines(t,i),o=this.createGeometry(t,r);return new F(r,o)}_createFlowFieldFromData(t){return(0,d.DE)(this.simulationSettings,t)}_getStreamlines(t,e){const{size:[n,i]}=t;return(0,d.qH)(this.simulationSettings,e,n,i)}};(0,i._)([(0,a.MZ)()],k.prototype,"simulationSettings",void 0),(0,i._)([(0,a.MZ)()],k.prototype,"loadImagery",void 0),(0,i._)([(0,a.MZ)()],k.prototype,"createGeometry",void 0),k=(0,i._)([(0,s.$)("esri.views.3d.support.flow.StreamlinesStyle3D")],k);var L=n(9902);let E=class extends p.A{constructor(t){super(t),this.type="flow",this._preorderIterator=new L.C2,this._abortController=null,this._debouncedLoad=(0,o.sg)(async()=>{var t;const{view:e,_style:n}=this;if(null==n)return;const i=this._computeExtent();if(null==i)return;const r={extent:i,timeExtent:this.layer.timeExtent,size:this._viewSizeWithEqualRatio(i),pixelRatio:e.state.contentPixelRatio};null==this._abortController&&(this._abortController=new AbortController);const l=this._abortController,a=await n.load(r,l.signal);(0,o.Te)(l.signal),null!=a&&(null!==(t=this._resources)&&void 0!==t&&t.detach(),a.attach(e.stage),this._resources=a)}),this._loadImagery=(t,e)=>{const{extent:n,size:[i,r],timeExtent:o}=t;return(0,d.pH)(this.layer,n,i,r,o,e)},this._createFlowGeometry=(t,e)=>_(this.view,t,e,this.elevationInfo)}initialize(){this.addHandles([(0,l.z7)(()=>this.newStyleRequired,()=>this._updateStyle(),l.OH)]),this.updatingHandles.add(()=>this._style,()=>this._triggerLoad()),this._updateStyle(),this.updatingHandles.addWhen(()=>{var t;return!(null!==(t=this.view.basemapTerrain)&&void 0!==t&&t.updating)},()=>this._triggerLoad())}destroy(){this._abortController=(0,r.DC)(this._abortController),this.clear()}get layer(){return this.layerView.layer}get flowRenderer(){const t=this.layer.renderer;return"flow"!==(null===t||void 0===t?void 0:t.type)?null:t}get elevationInfo(){return new h.A({mode:"absolute-height",offset:1e3})}get dataBounds(){const{fullExtent:t}=this.layer,{spatialReference:e}=this.view.basemapTerrain,n=(0,u.projectOrLoad)(t,e).geometry;return null==n?null:(0,c.VY)(n)}get simulationSettings(){const{flowRenderer:t}=this;return null==t?null:(0,f.hq)(t)}get newStyleRequired(){var t;const e=null===(t=this._style)||void 0===t?void 0:t.simulationSettings,n=this.simulationSettings;return null!=e&&null!=n&&!(0,f.r$)(e,n)}doRefresh(){return this._triggerLoad()}clear(){var t;null!==(t=this._resources)&&void 0!==t&&t.detach(),this._resources=null}_triggerLoad(){return(0,o.QZ)(this.updatingHandles.addPromise(this._debouncedLoad()))}_updateStyle(){var t;const{simulationSettings:e}=this;null!=e&&(null!==(t=this._style)&&void 0!==t&&t.destroy(),this._style=new k({simulationSettings:e,loadImagery:this._loadImagery,createGeometry:this._createFlowGeometry}))}_computeExtent(){const t=this.view.basemapTerrain,e=null===t||void 0===t?void 0:t.rootTiles;if(null==e||0===e.length)return null;const{spatialReference:n}=t,{dataBounds:i}=this;if(!n||null==i)return null;const r=b(e,this._preorderIterator,i);return null==r?null:((0,c.E$)(r,i,r),(0,c.w1)(r,n))}_viewSizeWithEqualRatio(t){const e=(t.xmax-t.xmin)/(t.ymax-t.ymin),[n,i]=this.view.size;return n<i?[n,Math.floor(n/e)]:[Math.floor(i*e),i]}get test(){}};(0,i._)([(0,a.MZ)()],E.prototype,"type",void 0),(0,i._)([(0,a.MZ)()],E.prototype,"_style",void 0),(0,i._)([(0,a.MZ)()],E.prototype,"layer",null),(0,i._)([(0,a.MZ)()],E.prototype,"flowRenderer",null),(0,i._)([(0,a.MZ)()],E.prototype,"elevationInfo",null),(0,i._)([(0,a.MZ)()],E.prototype,"dataBounds",null),(0,i._)([(0,a.MZ)()],E.prototype,"simulationSettings",null),(0,i._)([(0,a.MZ)()],E.prototype,"newStyleRequired",null),E=(0,i._)([(0,s.$)("esri.views.3d.layers.FlowSubView3D")],E)}}]);
//# sourceMappingURL=24280.b8bcdc39.chunk.js.map